<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <link href="https://vjs.zencdn.net/8.0.4/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.0.4/video.min.js"></script>
    <script src="https://kit.fontawesome.com/a4984d79d1.js" crossorigin="anonymous"></script>
    <script src="../../js/device.js"></script>
    <script src="../../js/jquery/blockui.js"></script>

    <!--<script src="https://malsup.github.io/jquery.blockUI.js"></script>-->
</head>
<body>
    <script>

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
        }

        var queryParams = window.location.search.substring(1).split('&');
        function GetQueryStringVar(_name, _keyvalpairs) {
            for (var i = 0; i < _keyvalpairs.length; i++) {
                var _param = _keyvalpairs[i].split('=');
                console.log('GetQueryStringVar: ' + _param[0].toLowerCase());
                if (_param[0].toLowerCase() === _name) {
                    return _param[1];
                }
            }
            return null;
        }

        var biztalkName = GetQueryStringVar('biztalkname', queryParams);
        var biztalkId = GetQueryStringVar('biztalkid', queryParams);

        let state = {};
        state.videoURL = '';
        state.insertCompleted = false;

        $(function () {

            console.log(`encoded biztalkname: ${biztalkName} | decoded biztalkname: ${window.atob(biztalkName)}`)
            $('#BiztalkName').text(`${window.atob(biztalkName)}`);
            $('#BiztalkId').text(`Your VidTok Id is ${window.atob(biztalkId)}`);
            $('#biztalkUrl').attr('href', `https://biztalks.azurewebsites.net/${window.atob(biztalkId)}`);
            $('#biztalkLink').text(`https://biztalks.azurewebsites.net/${window.atob(biztalkId)}`);
            $('#smsMessage').text(`https://biztalks.azurewebsites.net/${window.atob(biztalkId)}`);
            $('#emailMessage').text(`https://biztalks.azurewebsites.net/${window.atob(biztalkId)}`);
            
        })
        let device = new Device('createbiztalk_1-2.html');
        function sendEmail() {
            $.blockUI({ message: 'Sending Message Email' });
            //$('#buttonSaveIcon').removeClass('fa-regular fa-floppy-disk');
            //$('#buttonSaveIcon').addClass('fa fa-spinner fa-spin fa-fw');
            //$("#savePostcard").attr("disabled", true);
            setTimeout(function () {
            //string email = Convert.ToString(jObject["email"]);
            //string title = Convert.ToString(jObject["title"]);
            //string message = Convert.ToString(jObject["message"]);

                let jObject = {};
                jObject.correlationId = device.GenerateUUID();
                jObject.methodName = 'SendVidTokEmail';
                jObject.email = $('#inputEmailAddress').val();
                jObject.title = $('#inputEmailTitle').val();
                jObject.message = $('#emailMessage').val();

                let request = jObject;
                let result = parent.Post2Server(request, "sendVidTokEmail").responseText;
                console.log(`result= ${result}`);
                $.unblockUI();
                alert('Email Sent!');
            }, 500);
        }

        function sendSMS() {
            $.blockUI({ message: 'Sending Message SMS' });
            setTimeout(function () {

                let jObject = {};
                jObject.correlationId = device.GenerateUUID();
                jObject.methodName = 'SendVidTokSMS';
                jObject.phoneNumber = $('#inputPhoneNumber').val();
                jObject.message = $('#smsMessage').val();

                let request = jObject;
                let result = parent.Post2Server(request, "sendVidTokSMS").responseText;
                console.log(`result= ${result}`);
                $.unblockUI();
                alert('SMS Sent!');
            }, 500);
        }
    </script>
    <!-- Bootstrap Form Input -->
    <div style="margin-top: 0px; width: 400px" class="card">
        <div class="col-12" style="height:70px">
            <h4 id="BiztalkName" style="margin-top: 10px; margin-left: 10px;" class="">
                <img class="card-img-top float-left" src="../../Assets/iadvizrsLogo.png" alt="Card image" style="width:50px">Biztalk - Postcard
            </h4>
            <hr />

        </div>

        <div class="card-body">
            <h5 class="col-12" id="BiztalkId"></h5>
            <a id="biztalkUrl" target="_blank" href="#" class="btn btn-primary">
            <span id="biztalkLink"></span></a>
        </div>

        <div class="col-12" id="SendSMSMessage">
            <div class="form-group">
                <label for="inputPhoneNumber" class="form-label"> Recipient Phone Number </label>
                <input type="tel" class="form-control" id="inputPhoneNumber" placeholder="">
            </div>
            <div class="form-group" style="margin-top:10px">
                <label for="smsMessage">SMS Message < 155 Chars</label>
                <textarea class="form-control" id="smsMessage" rows="2"></textarea>
            </div>
            <button class="btn btn-primary" type="button" id="preview" onclick="sendSMS()"> Send </button>
        </div>
        <div class="col-12" id="SendEmailMessage">
            <div class="form-group">
                <label for="inputEmailAddress" class="form-label"> Recipient Email Address </label>
                <input type="email" class="form-control" id="inputEmailAddress" placeholder="">
            </div>
            <div class="form-group">
                <label for="inputEmailTitle" class="form-label"> Email Title </label>
                <input type="text" class="form-control" id="inputEmailTitle" placeholder="">
            </div>
            <div class="form-group" style="margin-top:10px">
                <label for="emailMessage">Email Message Body</label>
                <textarea class="form-control" id="emailMessage" rows="4"></textarea>
            </div>
            <button class="btn btn-primary" type="button" id="preview" onclick="sendEmail()"> Send </button>
        </div>
    </div>
</body>
</html>