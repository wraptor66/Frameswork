<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="libraries/jQuery-3.6.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link href="libraries/Cerulean.css" rel="stylesheet" />
</head>
<body>
    <form style="padding:20px" id="loginForm" class="col-12">
        <div class="form-group">
            <label for="formEmail">Member Email Address</label>
            <input type="email" class="form-control" id="formEmail" placeholder="name@example.com">
        </div>
        <div class="form-group">
            <label for="formPassword">Password</label>
            <input type="password" class="form-control" id="formPassword" placeholder="Password">
        </div>

        <button onclick="Login()" type="button" class="btn btn-primary">Submit</button>
    </form>
    <div id="moveNext" class="card text-white bg-primary mb-3" style="max-width: 20rem;display:none">
        <div class="card-header">Header</div>
        <div class="card-body">
            <h4 class="card-title">Logged In</h4>
            <p class="card-text">Hi <span id="FullName"></span>, you are now logged in. Close this Frame to access your features and functionalities.</p>
            <button onclick="Close()" type="button" class="btn btn-primary">Close</button>
        </div>
    </div>

    <script>
        let dialogName;
        $(document).ready(function () {
            let cachedVar = parent.getCachedVar();
            //alert(cachedVar.id);

            const params = new Proxy(new URLSearchParams(window.location.search), {
                get: (searchParams, prop) => searchParams.get(prop),
            });
        })
        ///call webapi to login
        ///assign return object to parent.memberprofile
        //login
        //model schema
        //public class MemberProfile: TransportBaseClass
        //{
        //    public Int64 Id { set; get; } = 0;
        //    public string FirstName { set; get; } = string.Empty;
        //    public string LastName { set; get; } = string.Empty;
        //    public string Email { set; get; } = string.Empty;
        //    public string Password { set; get; } = string.Empty;
        //    public Int16 Age { set; get; } = 0;
        //    public string Focus { set; get; } = string.Empty;
        //    public string Description { set; get; } = string.Empty;
        //    public string jTag { set; get; } = string.Empty;
        //}
        function Login() {
            let member = {};
            member.MethodName = "MemberLogin";
            member.ReturnType = "json";
            member.Email = $('#formEmail').val();
            member.Password = $('#formPassword').val();
            let request = JSON.stringify(member);
            parent.showNotificationBar('Login Request Sent');
            if (parent.Post2Server(request, 'customerProfile').statusText == 'success') {
                $('#loginForm').hide();
                $('#moveNext').show();
                $('#FullName').text(`${parent.getCustomerProfile().FirstName} ${parent.getCustomerProfile().LastName}`);
            }
        }

        function Close() {
            parent.RemoveWindow(dialogName);
        }
    </script>
</body>
</html>